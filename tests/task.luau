local this_thread = coroutine.running()
print(nameof(this_thread), this_thread, coroutine.status(this_thread))
local co = coroutine.create(function(word: string)
    print(`im a coroutine {word}`)
end)
print(`{script.name}: {nameof(this_thread)}`)
task.delayuntil(task.this, function()
    print("script is finished")
end)
task.spawn(function()
    task.waituntil(this_thread)
end)

local d = task.delay(5, co, "real")
task.cancel(d)
local yo = coroutine.create(function()
    while true do
        task.wait(1)
        print("yo")
    end
end)
xpcall(task.cancel, function(e)  print("fail", e) end,  yo)
task.spawn(function()
    task.waituntil(d)
    print('i waited')
end)
local s = task.spawn(function(str)
    task.delayuntil(task.this, function()
        print("after spawn")
    end)
    print(`status {nameof(this_thread)} = {coroutine.status(this_thread)}`)
    print(`yo {str}`)
    task.defer(function()
        print('i deferred')
    end)
end, "world")
print(`spawn {s}`)
collectgarbage('collect')
local e = task.defer(function(str)
    print(`bye bye {str}`)
end, "you")

local v = task.defer(function(str)
    task.wait(3)
    print(`bye {str}`)
end, "world")
this_thread = coroutine.running()
print(nameof(this_thread), this_thread, coroutine.status(this_thread))
print(`defer {v}`)
task.wait(6)
local cc = require('console_codes')
print(`{cc.brightgreen}{script.name} tests successful{cc.reset}`)
